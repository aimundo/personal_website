---
title: "GAMs in clinical data"
format:
  html:
    theme: default
    toc: true
    number-sections: true
editor_options: 
  chunk_output_type: console
---

```{r, setup}
library(here)
library(ggplot2)
library(tidyverse)
library(readxl)
library(mgcv)
library(viridis)
library(gratia)
```

Let's load the tumor size dataset. The data set comes from:
Varna M, Bertheau P, Legres LG. Tumor Microenvironment in Human Tumor Xenografted Mouse Models. Journal of Analytical Oncology 2014; 3(3): 159-166

And can be found in the Teaching of Statistics in the Health Sciences Portal here:
https://www.causeweb.org/tshs/tumor-growth/

The chunk below can be omitted as the repo already contains the `.csv` file.
```{r, load data and create csv file}

load("content/blog/tumorgrowth.RData")
write.csv(tumorgrowth,"content/blog/tumorgrowth.csv")
```


```{r,plot data}

data<-read.csv(here("content/blog/tumorgrowth.csv"))

#make variables a factor, if needed

data$Grp<-as.factor(data$Grp)
data$ID<-as.factor(data$ID)

#make an object to store the visualization
raw_plot<-ggplot(data=data,aes(x=Day,y=Size))

#simple plot
raw_plot+geom_point()+
    facet_wrap(~Grp)+
    theme_bw()
```

There are four treatment groups. Let's see how tumors change over time by adding lines and making the points specific per each subject.

```{r,plot data}

raw_plot+
    geom_point(aes(color=ID),size=2, alpha=0.4,show.legend=FALSE)+
    geom_line(aes(color=ID),size=1,alpha=0.5,show.legend=FALSE)+
    theme_bw()+
    facet_wrap(~Grp)+
        scale_color_viridis_d(option="turbo")
```


Now, if we want to fit a GAM to the data, the syntax needs to be the following:

```{r, gam-1}
gam1 <- gam(Size ~ Grp+s(Day, by = Grp, k = 10),
          method='REML',
          data  = data)

plot.gam(gam1)
appraise(gam1)
gam.check(gam1)
```
